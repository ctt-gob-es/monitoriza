<div class="container-fluid">
	<h4 class="c-grey-900 mT-10 mB-30" th:text="#{applalert.admin.title}"></h4>
	<div class="row">
		<div class="col-md-12">
			<div class="bgc-white bd bdrs-3 p-20 mB-20">
				<h4 class="c-grey-900 mB-20"
					th:text="#{applalert.summaries.admin.title}"></h4>
				<table id="summariesTable"
					class="table table-striped table-bordered" cellspacing="0"
					width="100%">
					<thead>
						<tr>
							<!-- Columna vacia para identificador -->
							<th></th>
							<th th:text="#{table.summaries.name}"></th>
							<th th:text="#{table.summaries.description}"></th>
							<th th:text="#{table.summaries.periodicity}"></th>
							<th th:text="#{table.summaries.active}"></th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<div id="resumeModal"></div>
<script th:inline="javascript">
$(document).ready(function() {
	var getResumes = /*[[@{/resumesdatatable}]]*/;
	var getNewResumeInfo = /*[[@{/newresumeinfo}]]*/;
	var addTemplate = /*[[@{/addresume}]]*/;
	
	var tbl = $('#summariesTable').DataTable({
		dom: 'Bfrtip',
	    select: 'single',
	    responsive: true,
	    
	    altEditor: true,
	    buttons: [{text: 'Agregar', name: 'addSummary',
					action: function ( e, dt, node, config ) {

					loading();
  				  
            		$.ajax(getNewResumeInfo, {
		            	dataType : 'html',
		            	contentType:'application/json',
		                data : JSON.stringify($("#summaryForm").serializeJSON()),
		                type:'POST'
		            })
		            .done(function (data) {
		            	 hide();
		            	 $('#resumeModal').html(data);
		            	 $('#summaryModal').modal('show');
    		         }) ;
  			  }}, 
	    	{extend: 'selected',text: 'Editar',name: 'edit',
					action: function ( e, dt, node, config ) {

					loading();  

					for (var o = dt, a = [], e = 0; e < o.context[0].aoColumns.length; e++) a.push({
						id: o.context[0].aoColumns[e].mData           
					});
							  
					var d = dt.rows({
						selected: !0
					});
								
					var idResumeMonitoriza = d.data()[0][a[0].id];
  				  
            		$.ajax(getNeesumeInfo, {
		            	dataType : 'json',
		            	contentType:'application/json',
		                data : idResumeMonitoriza,
		                type:'POST',
		                success: function(data){
		            		// Se oculta la capa 'cargando...'
		                	hide();
		                },
		                error:function(data){
		                	hide();
		                	$('#errorModalUser').remove();
		                	$('#userForm').append('<div id="errorModalUser" class="alert alert-danger" role="alert"><strong>ERROR</strong></div>');
		                }
		            });
					
  			  }},  
	    	{extend: 'selected',text: 'Eliminar',name: 'delete'}
			],
	
	    "iTotalRecords": "totalElements",
        "iTotalDisplayRecords": "numberOfElements",
	    
		"processing": true,
	    "serverSide": true,
	    "language": {
	        "url": "js/datatables/i18n/spanish.json",
	        select: {
	            rows: {
	                _: "%d filas seleccionadas",
	                1: "1 fila seleccionada"
	            }
	          }
	        },
		"ajax": {
				"url": getResumes,
				"dataSrc" : "data",
				"data": function (data) {
					// Datos a pasar al modal
					// data.formId = "nodeForm";
					data.getNewResumeInfo = getNewResumeInfo;
					data.addTemplate = addTemplate;
			        }
		},
		"columns": [
			{ "data": "idResumeMonitoriza",
		          		"visible": false},
	        { "data": "name" },
	        { "data": "description" },
	        { "data": "periodicity" },
	        { "data": "enabled",
				"render": function (data, type, row) {  
					var is_checked = data == "S" ? "checked" : "";
		        	return '<div class="checkbox checkbox-circle checkbox-info peers ai-c"><input disabled type="checkbox" id="isEnabledCheck" class="peer"' + is_checked + '><label for="isEnabledCheck" class="peers peer-greed js-sb ai-c"><span class="peer peer-greed" ></span></label></div>';	        	  
		          }		
			}
			]
		});
});	

</script>