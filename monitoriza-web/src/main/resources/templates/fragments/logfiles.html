<div class="container-fluid" id="tableLogFiles">
	<h4 class="c-grey-900 mT-10 mB-30" th:text="#{log.files.admin.title}"></h4>
	<div class="row">
		<div class="col-md-12">
			<div class="bgc-white bd bdrs-3 p-20 mB-20">
				<h4 class="c-grey-900 mB-20" th:text="#{table.log.files.title}"></h4>
				<table id="logFilesTable" class="table table-striped table-bordered" 
					cellspacing="0" width="100%">
					<thead>
						<tr>
							<!-- Columna oculta para el identificador de la plataforma -->
							<th th:text="#{table.log.file.name}"></th>
							<th th:text="#{table.log.file.date}"></th>
							<th th:text="#{table.log.file.size}"></th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<script th:inline="javascript">
$(document).ready(function() {

	var logFiles = /*[[@{/logfilesdatatable}]]*/;
	
	var tbl = $('#logFilesTable').DataTable({
		dom: 'Bfrtip',
	    select: 'single',
	    responsive: true,
	    
	    altEditor: true,
	    buttons: [
	    	{text: 'Abrir', name: 'openFile', extend: 'selected', action: openLogFile}
	    ],

	    "iTotalRecords": "totalElements",
        "iTotalDisplayRecords": "numberOfElements",
        
		"processing": true,
	    "serverSide": false,
	    

	    "language": {
	        "url": "js/datatables/i18n/spanish.json",
	        select: {
	            rows: {
	                _: "%d filas seleccionadas",
	                1: "1 fila seleccionada"
	            }
	        }
	    },

		"columns": [
	        { "data": "name" },
	        { "data": "date" },
	        { "data": "size" }
	    ],

		"ajax": {
	        "url": logFiles,
	        "dataSrc" : "data",
	        "type": "GET"
	    }

	});	

});

function openLogFile ( e, dt, node, config ) {

	e.preventDefault();
	
	loading();
	
	// Se obtienen las filas seleccionadas (que deberia ser solo una)
	var d = dt.rows({
        selected: !0
    })
    
	// Si no se puede extraer la informacion de la fila, no se hace nada 
    if (d.data().length <= 0) {
    	hide();
    	return;
    }

	// Se obtiene el identificador y el indice correspondiente a la fila seleccionada
	var id = d.data().name;
	var index = d.indexes();

	var openLogFileService = /*[[@{/openlogfile}]]*/;
    $.ajax(openLogFileService, {
		data: $.param({'id':id, 'index':index}),
        type: 'POST',
        success: function(data) {
    		// Se oculta la capa 'cargando...'
    		hide();

    		var actionUser = /*[[@{/logfileopen}]]*/;
         	loadIntoAjax(null, actionUser, 'optionReplacement', 'GET', null, true);
        },
        error:function(data){
        	// Se oculta la capa 'cargando...'
        	hide();
        
		}
	});
}

</script>