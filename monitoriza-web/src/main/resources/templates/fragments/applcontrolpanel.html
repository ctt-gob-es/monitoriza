<div class="container-fluid">
	<h4 class="c-grey-900 mT-10 mB-30" th:text="#{applalert.admin.title}"></h4>
	<div class="row">
		<div class="col-md-12">
			<div class="bgc-white bd bdrs-3 p-20 mB-20">
				<h4 class="c-grey-900 mB-20" th:text="#{table.applalert.controlpanel.title}"></h4>
				<label for="period" th:text="#{applalert.controlpanel.period}"></label>
					<form id="auditsForm" name="altEditor-form" role="form" th:object="${auditsform}" action="#" method="post">
					<div class="form-row">
						<div class="form-group col-md-2">
							<select id="period" name="period" th:field="*{period}" class="form-control">
								<option selected="selected" value="0" th:text="#{applalert.controlpanel.period.all}"></option>
								<option value="-10" th:text="#{applalert.controlpanel.period.last10minutes}"></option>
								<option value="-60" th:text="#{applalert.controlpanel.period.lasthour}"></option>
								<option value="-180" th:text="#{applalert.controlpanel.period.last3hours}"></option>
							</select>
						</div>
						<div class="form-group col-md-2">
							<button th:text="#{applalert.controlpanel.period.consult}" class="btn btn-primary" id="filterAuditsBtn" type="button"></button>
						</div>
					</div>
				</form>
				<table id="alertAuditTable" class="table table-striped table-bordered" 
					cellspacing="0" width="100%">
					<thead>
						<tr>
							<!-- Columna oculta para el identificador del aviso de sistema -->
							<th th:text="#{table.applalert.controlpanel.hour}"></th>
							<th th:text="#{table.applalert.controlpanel.application}"></th>
							<th th:text="#{table.applalert.controlpanel.node}"></th>
							<th th:text="#{table.applalert.controlpanel.alert}"></th>
							<th th:text="#{table.applalert.controlpanel.citricity}"></th>
							<th th:text="#{table.applalert.controlpanel.description}"></th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<script th:inline="javascript">
$(document).ready(function() {
	var getAlertAudit = /*[[@{/alertauditdatatable}]]*/;
	var filterAudits = /*[[@{/filteralertaudits}]]*/;
	
	var auditsTable = $('#alertAuditTable').DataTable({
		dom: 'Bfrtip',
		buttons: [],
	    select: 'single',
	    responsive: true,
	    altEditor: true,
	
	    "iTotalRecords": "totalElements",
        "iTotalDisplayRecords": "numberOfElements",
	    
		"processing": true,
		
	    "language": {
	        "url": "js/datatables/i18n/spanish.json",
	        select: {
	            rows: {
	                _: "%d filas seleccionadas",
	                1: "1 fila seleccionada"
	            }
	          }
	        },
		"ajax": {
				"url": getAlertAudit,
				"dataSrc" : "data",
				"data": function (data) {
				}
		},
		"columns": [
	        { "data": "timestamp",
				"render": function (data, type, row, meta) {
					return moment.utc(data).local().format('HH:mm:ss');
			}},
	        { "data": "appName" },
	        { "data": "node" },
	        { "data": "alertName" },
	        { "data": "severity" },
	        { "data": "description" }
	        ]
		});

	$('#filterAuditsBtn').on( 'click', function () {

		    loading();
		    
			$.ajax(filterAudits, {
		    	dataType : 'json',
		    	contentType:'application/json',
		        data : JSON.stringify($("#auditsForm").serializeJSON()),
		        type:'POST',
		        success: function(data){
		    		// Se oculta la capa 'cargando...'
		    		hide();
		    		auditsTable.clear().draw();
		    		auditsTable.rows.add($(data.data)); 
		    		auditsTable.draw(); 
		        },
		        error:function(data){
		        	hide();
		        	$('#errorModalAudit').remove();
		        	$('#auditsForm').append('<div id="errorModalAudit" class="alert alert-danger" role="alert"><strong>' +[[#{message.error}]]+ '</strong></div>');
		        }
		    });
		
	 });
});	

</script>